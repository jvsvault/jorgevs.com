<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Image Fallback Issue</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #333;
      color: #fff;
    }
    .test-area {
      background: rgba(0,0,0,0.5);
      padding: 20px;
      margin: 20px 0;
      border-radius: 8px;
    }
    .success { color: #0f0; }
    .error { color: #f00; }
    .warning { color: #ff0; }
    pre {
      background: #000;
      padding: 10px;
      overflow-x: auto;
    }
    button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Image Fallback Test</h1>
  
  <div class="test-area">
    <h2>Test 1: Check if images exist</h2>
    <button onclick="checkImages()">Check All Images</button>
    <div id="image-check"></div>
  </div>
  
  <div class="test-area">
    <h2>Test 2: Simulate Randomizer Logic</h2>
    <button onclick="simulateRandomizer()">Simulate Randomizer</button>
    <div id="randomizer-sim"></div>
  </div>
  
  <div class="test-area">
    <h2>Test 3: Modified Randomizer (No Fallback)</h2>
    <button onclick="testModifiedRandomizer()">Test Modified Logic</button>
    <div id="modified-test"></div>
  </div>

  <script>
    // List of images from randomizer
    const bgGeoImages = [
      '00420020.JPG',
      'R1-02565-022A.JPG',
      'r001-004.jpg',
      'r001-005.jpg',
      'r001-012.jpg',
      'r001-013.jpg',
      'r001-018.jpg',
      'r001-020.jpg',
      'r001-021 2.jpg',
      'r001-025.jpg'
    ];
    
    // Check if all images exist
    async function checkImages() {
      const result = document.getElementById('image-check');
      let html = '<h3>Checking images...</h3>';
      
      for (const imageName of bgGeoImages) {
        const path = `/assets/images/bg-geo/${imageName}`;
        const img = new Image();
        
        const exists = await new Promise((resolve) => {
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
          img.src = path;
        });
        
        html += `<p class="${exists ? 'success' : 'error'}">
          ${exists ? '✓' : '✗'} ${path}
        </p>`;
      }
      
      result.innerHTML = html;
    }
    
    // Simulate randomizer logic
    async function simulateRandomizer() {
      const result = document.getElementById('randomizer-sim');
      result.innerHTML = '<h3>Simulating randomizer...</h3>';
      
      // Pick random image
      const bgIndex = Math.floor(Math.random() * bgGeoImages.length);
      const selectedImage = bgGeoImages[bgIndex];
      const imagePath = `/assets/images/bg-geo/${selectedImage}`;
      
      result.innerHTML += `<p>Selected: ${selectedImage}</p>`;
      result.innerHTML += `<p>Path: ${imagePath}</p>`;
      
      // Set CSS variable
      document.documentElement.style.setProperty('--bg-image', `url('${imagePath}')`);
      result.innerHTML += '<p class="success">✓ Set --bg-image CSS variable</p>';
      
      // Test image loading (like randomizer does)
      const testImg = new Image();
      testImg.onerror = () => {
        result.innerHTML += '<p class="error">✗ Image failed to load!</p>';
        result.innerHTML += '<p class="warning">⚠️ Randomizer would set background to "none" here!</p>';
        
        // This is what the randomizer does on error:
        document.documentElement.style.setProperty('--bg-image', 'none');
        document.documentElement.style.setProperty('background-color', '#1a1a1a');
      };
      testImg.onload = () => {
        result.innerHTML += '<p class="success">✓ Image loaded successfully!</p>';
        result.innerHTML += '<p>Background should be visible now.</p>';
      };
      testImg.src = imagePath;
    }
    
    // Test modified logic without fallback
    async function testModifiedRandomizer() {
      const result = document.getElementById('modified-test');
      result.innerHTML = '<h3>Testing modified logic...</h3>';
      
      // Try each image until one works
      let imageSet = false;
      
      for (let i = 0; i < bgGeoImages.length; i++) {
        const imageName = bgGeoImages[i];
        const imagePath = `/assets/images/bg-geo/${imageName}`;
        
        const img = new Image();
        const loaded = await new Promise((resolve) => {
          img.onload = () => resolve(true);
          img.onerror = () => resolve(false);
          img.src = imagePath;
        });
        
        if (loaded) {
          document.documentElement.style.setProperty('--bg-image', `url('${imagePath}')`);
          result.innerHTML += `<p class="success">✓ Set background to: ${imageName}</p>`;
          imageSet = true;
          break;
        } else {
          result.innerHTML += `<p class="warning">⚠️ Skipped: ${imageName}</p>`;
        }
      }
      
      if (!imageSet) {
        result.innerHTML += '<p class="error">✗ No images could be loaded!</p>';
      }
    }
    
    // Add some debug CSS to see the background
    const style = document.createElement('style');
    style.textContent = `
      body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: var(--bg-image);
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        z-index: -1;
        opacity: 0.3;
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>