<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Background Image</title>
  
  <!-- Load the main CSS -->
  <link rel="stylesheet" href="/assets/css/main-v3-clean.css">
  
  <style>
    /* Debug styles */
    .debug-panel {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.9);
      color: black;
      padding: 20px;
      border-radius: 8px;
      max-width: 400px;
      z-index: 9999;
    }
    .debug-panel h3 {
      margin: 0 0 10px 0;
    }
    .debug-panel pre {
      background: #f0f0f0;
      padding: 10px;
      margin: 10px 0;
      overflow-x: auto;
    }
    .test-button {
      background: #007bff;
      color: white;
      border: none;
      padding: 10px 20px;
      margin: 5px;
      cursor: pointer;
      border-radius: 4px;
    }
    .test-button:hover {
      background: #0056b3;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="title-container">
      <h1>Jorge Viñals</h1>
    </div>
    <p style="color: white; padding: 20px;">This is a test page to debug the background image issue.</p>
  </div>

  <div class="debug-panel">
    <h3>Debug Panel</h3>
    
    <div id="current-status"></div>
    
    <div style="margin-top: 20px;">
      <button class="test-button" onclick="setBackgroundManually()">Set Background Manually</button>
      <button class="test-button" onclick="loadRandomizer()">Load Randomizer</button>
      <button class="test-button" onclick="checkCSSVariables()">Check CSS Variables</button>
    </div>
    
    <div id="debug-output"></div>
  </div>

  <script>
    const debugOutput = document.getElementById('debug-output');
    const currentStatus = document.getElementById('current-status');
    
    // Check initial state
    function checkInitialState() {
      const computedStyle = getComputedStyle(document.documentElement);
      const bgImage = computedStyle.getPropertyValue('--bg-image');
      const bodyBefore = getComputedStyle(document.body, '::before');
      
      currentStatus.innerHTML = `
        <p><strong>Initial State:</strong></p>
        <p>--bg-image: ${bgImage || 'NOT SET'}</p>
        <p>Body background-color: ${getComputedStyle(document.body).backgroundColor}</p>
        <p>Location: ${window.location.host}</p>
      `;
    }
    
    // Set background manually
    function setBackgroundManually() {
      const imagePath = '/assets/images/bg-geo/r001-004.jpg';
      document.documentElement.style.setProperty('--bg-image', `url('${imagePath}')`);
      
      debugOutput.innerHTML = `
        <pre>Manual background set:
${imagePath}

CSS Variable now: ${getComputedStyle(document.documentElement).getPropertyValue('--bg-image')}</pre>
      `;
      
      // Test if image loads
      const img = new Image();
      img.onload = () => {
        debugOutput.innerHTML += '<p style="color: green;">✓ Image loaded successfully!</p>';
      };
      img.onerror = () => {
        debugOutput.innerHTML += '<p style="color: red;">✗ Image failed to load!</p>';
      };
      img.src = imagePath;
    }
    
    // Load the randomizer module
    async function loadRandomizer() {
      try {
        debugOutput.innerHTML = '<p>Loading randomizer module...</p>';
        
        const module = await import('/assets/js/randomizer.js');
        debugOutput.innerHTML += '<p style="color: green;">✓ Module loaded</p>';
        
        // Initialize randomizer
        if (module.default && typeof module.default.initialize === 'function') {
          await module.default.initialize();
          debugOutput.innerHTML += '<p style="color: green;">✓ Randomizer initialized</p>';
          
          // Check what was set
          const bgImage = getComputedStyle(document.documentElement).getPropertyValue('--bg-image');
          debugOutput.innerHTML += `<pre>Background set to: ${bgImage}</pre>`;
        } else {
          debugOutput.innerHTML += '<p style="color: red;">✗ Randomizer not found in module</p>';
        }
      } catch (error) {
        debugOutput.innerHTML = `<p style="color: red;">✗ Error: ${error.message}</p>`;
        console.error('Randomizer error:', error);
      }
    }
    
    // Check all CSS variables
    function checkCSSVariables() {
      const computedStyle = getComputedStyle(document.documentElement);
      const variables = [
        '--bg-image',
        '--text-color',
        '--border-color',
        '--accent-color',
        '--geometry-texture'
      ];
      
      let html = '<h4>CSS Variables:</h4><pre>';
      variables.forEach(varName => {
        const value = computedStyle.getPropertyValue(varName);
        html += `${varName}: ${value || 'NOT SET'}\n`;
      });
      html += '</pre>';
      
      // Also check body styles
      const bodyStyles = getComputedStyle(document.body);
      html += '<h4>Body Styles:</h4><pre>';
      html += `background-color: ${bodyStyles.backgroundColor}\n`;
      html += `color: ${bodyStyles.color}\n`;
      html += `opacity: ${bodyStyles.opacity}\n`;
      html += '</pre>';
      
      debugOutput.innerHTML = html;
    }
    
    // Check initial state on load
    checkInitialState();
    
    // Monitor console errors
    window.addEventListener('error', (e) => {
      debugOutput.innerHTML += `<p style="color: red;">JS Error: ${e.message}</p>`;
    });
  </script>
</body>
</html>