<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug Localhost vs Production</title>
  <style>
    body {
      font-family: monospace;
      padding: 20px;
      background: #222;
      color: #0f0;
    }
    .section {
      margin: 20px 0;
      padding: 20px;
      border: 1px solid #0f0;
    }
    .error {
      color: #f00;
    }
    .success {
      color: #0f0;
    }
    pre {
      background: #000;
      padding: 10px;
      overflow-x: auto;
    }
  </style>
</head>
<body>
  <h1>Debug: Localhost vs Production</h1>
  
  <div class="section">
    <h2>1. Current Location</h2>
    <div id="location"></div>
  </div>

  <div class="section">
    <h2>2. CSS Loading Test</h2>
    <div id="css-test"></div>
  </div>

  <div class="section">
    <h2>3. Image Loading Test</h2>
    <div id="image-test"></div>
  </div>

  <div class="section">
    <h2>4. JavaScript Module Test</h2>
    <div id="js-test"></div>
  </div>

  <div class="section">
    <h2>5. API Endpoint Test</h2>
    <div id="api-test"></div>
  </div>

  <div class="section">
    <h2>6. Console Errors</h2>
    <div id="console-errors"></div>
  </div>

  <div class="section">
    <h2>7. Network Requests</h2>
    <div id="network-requests"></div>
  </div>

  <script>
    // Store console errors
    const consoleErrors = [];
    const originalError = console.error;
    console.error = function() {
      consoleErrors.push(Array.from(arguments).join(' '));
      originalError.apply(console, arguments);
    };

    // 1. Show current location
    document.getElementById('location').innerHTML = `
      <p>Host: ${window.location.host}</p>
      <p>Protocol: ${window.location.protocol}</p>
      <p>Origin: ${window.location.origin}</p>
      <p>Is localhost: ${window.location.host.includes('localhost') ? 'YES' : 'NO'}</p>
    `;

    // 2. Test CSS loading
    async function testCSS() {
      const cssPath = '/assets/css/main-v3-clean.css';
      const result = document.getElementById('css-test');
      
      try {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = cssPath;
        
        await new Promise((resolve, reject) => {
          link.onload = resolve;
          link.onerror = reject;
          document.head.appendChild(link);
        });

        // Check if CSS variable is set
        const rootStyles = getComputedStyle(document.documentElement);
        const bgImage = rootStyles.getPropertyValue('--bg-image');
        
        result.innerHTML = `
          <p class="success">✓ CSS loaded successfully</p>
          <p>--bg-image variable: ${bgImage || 'NOT SET'}</p>
          <p>Full path: ${window.location.origin}${cssPath}</p>
        `;
      } catch (error) {
        result.innerHTML = `<p class="error">✗ CSS failed to load: ${error}</p>`;
      }
    }

    // 3. Test image loading
    async function testImages() {
      const result = document.getElementById('image-test');
      const testPaths = [
        '/assets/images/bg-geo/r001-004.jpg',
        '/assets/images/profile/110-2048x1153.jpg',
        '/assets/images/2024/04/110.jpg'
      ];
      
      let html = '';
      
      for (const path of testPaths) {
        try {
          const img = new Image();
          await new Promise((resolve, reject) => {
            img.onload = resolve;
            img.onerror = reject;
            img.src = path;
          });
          html += `<p class="success">✓ ${path}</p>`;
        } catch (error) {
          html += `<p class="error">✗ ${path}</p>`;
        }
      }
      
      result.innerHTML = html;
    }

    // 4. Test JavaScript module loading
    async function testJS() {
      const result = document.getElementById('js-test');
      const jsPath = '/assets/js/main.js';
      
      try {
        const module = await import(jsPath);
        result.innerHTML = `
          <p class="success">✓ JavaScript module loaded</p>
          <p>Module type: ${typeof module}</p>
          <p>Full path: ${window.location.origin}${jsPath}</p>
        `;
      } catch (error) {
        result.innerHTML = `
          <p class="error">✗ JavaScript failed: ${error}</p>
          <p>Attempted path: ${window.location.origin}${jsPath}</p>
        `;
      }
    }

    // 5. Test API endpoint
    async function testAPI() {
      const result = document.getElementById('api-test');
      
      try {
        const response = await fetch('/api/images');
        const data = await response.json();
        
        result.innerHTML = `
          <p class="success">✓ API endpoint working</p>
          <p>Response status: ${response.status}</p>
          <p>bgGeo images: ${data.bgGeo?.length || 0}</p>
          <p>profile images: ${data.profile?.length || 0}</p>
        `;
      } catch (error) {
        result.innerHTML = `<p class="error">✗ API failed: ${error}</p>`;
      }
    }

    // 6. Show console errors
    function showErrors() {
      const result = document.getElementById('console-errors');
      if (consoleErrors.length === 0) {
        result.innerHTML = '<p class="success">No console errors</p>';
      } else {
        result.innerHTML = '<pre class="error">' + consoleErrors.join('\n') + '</pre>';
      }
    }

    // 7. Monitor network requests
    const networkRequests = [];
    const observer = new PerformanceObserver((list) => {
      for (const entry of list.getEntries()) {
        if (entry.initiatorType === 'fetch' || entry.initiatorType === 'xmlhttprequest') {
          networkRequests.push({
            name: entry.name,
            duration: entry.duration,
            status: entry.responseStatus || 'unknown'
          });
        }
      }
    });
    observer.observe({ entryTypes: ['resource'] });

    // Run all tests
    async function runTests() {
      await testCSS();
      await testImages();
      await testJS();
      await testAPI();
      showErrors();
      
      // Show network requests after a delay
      setTimeout(() => {
        const result = document.getElementById('network-requests');
        if (networkRequests.length === 0) {
          result.innerHTML = '<p>No network requests captured</p>';
        } else {
          result.innerHTML = '<pre>' + JSON.stringify(networkRequests, null, 2) + '</pre>';
        }
      }, 2000);
    }

    // Run tests on load
    window.addEventListener('load', runTests);
  </script>
</body>
</html>